{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>日志编辑</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="{%static 'css/bootstrap.min.css' %}" />
  <link rel="stylesheet" href="{%static 'css/bootstrap-responsive.min.css' %}" />
  <link rel="stylesheet" href="{%static 'css/uniform.css' %}" />
  <link rel="stylesheet" href="{%static 'css/select2.css' %}" />
  <link rel="stylesheet" href="{%static 'css/matrix-style.css' %}" />
  <link rel="stylesheet" href="{%static 'css/matrix-media.css' %}" />
  <link rel="stylesheet" href="{%static 'css/bootstrap-wysihtml5.css' %}" />
  <link href="{%static 'font-awesome/css/font-awesome.css' %}" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
</head>
<body>

<!--Header-part-->
<div id="header">
  <h1><a href="dashboard.html">MatAdmin</a></h1>
</div>
<!--close-Header-part--> 

<!--top-Header-menu-->
<div id="user-nav" class="navbar navbar-inverse">
  <ul class="nav">
    <li  class="dropdown" id="profile-messages" ><a title="" href="#" data-toggle="dropdown" data-target="#profile-messages" class="dropdown-toggle"><i class="icon icon-user"></i>  <span class="text">欢迎Admin</span><b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href="/stu_personal."><i class="icon-user"></i> 我的资料</a></li>
        <li class="divider"></li>
        <li><a href="/logout/"><i class="icon-key"></i> 退出</a></li>
      </ul>
    </li>
    <li class=""><a title="" href="/logout/"><i class="icon icon-share-alt"></i> <span class="text">退出</span></a></li>
  </ul>
</div>

<!--sidebar-menu-->

<div id="sidebar"> <a href="#" class="visible-phone"><i class="icon icon-list"></i>Forms</a>
 <ul>
    <li><a href="/student/"><i class="icon icon-home"></i> <span>首页</span></a> </li>
<!--    <li> <a href="/groups/"><i class="icon icon-inbox"></i> <span>我的课题组</span></a> </li>-->
    <li><a href="/stu_query_instru/"><i class="icon icon-th"></i> <span>仪器预约 & 查询</span></a></li>
    <li><a href="/reservation_log/"><i class="icon icon-th-list"></i> <span>预约记录</span> </a></li>
    <li><a href="/logs/"><i class="icon icon-pencil"></i> <span>实验日志</span></a></li>
    <li class="active"><a href="#"><i class="icon icon-unlock"></i> <span>编辑日志</span> </a></li>
  </ul>
</div>

<!--close-left-menu-stats-sidebar-->

<div id="content">
<div id="content-header">
  <div id="breadcrumb"> <a href="/student/" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a><a href="/logs/"> 实验日志 </a> <a href="#" class="current">编辑日志</a> </div>
  <h1>编辑实验日志</h1>
</div>
<div class="container-fluid" >
  <hr>
  <div class="row-fluid" style="text-align:right;">
    <div class="span12" >
      <div class="widget-box">
        <div class="widget-title" style="color: black"> <span class="icon"> <i class="icon-bookmark"></i> </span>
          <h5 style="font-size:15px;color:black">日志</h5>
        </div>
        <div class="widget-content">
          <form class="form-horizontal" style="text-align:right;" method="post" action="#" name="number_validate" id="number_validate" novalidate="novalidate">
              <div class="control-group" >
              <label class="control-label" style="padding-left:100px;">日志编号 </label>
              <div class="controls">
                <p style="FONT-SIZE:14px; text-align:center;" > {{log_id}}</p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">实验项目 </label>
              <div class="controls">
<!--                <input type="text" class="span11" placeholder="Name" />-->
                  <p style="FONT-SIZE:14px; text-align:center"> {{item}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">仪器名称及编号 </label>
              <div class="controls">
<!--                <input type="text" class="span11" placeholder="ID number" />-->
                  <p style="FONT-SIZE:14px; text-align:center"> {{equip_name}} {{equip_id}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">课题组</label>
              <div class="controls">
<!--                <input type="password"  class="span11" placeholder="Group ID"  />-->
                  <p style="FONT-SIZE:14px; text-align:center"> {{course_name}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">课题组导师 </label>
              <div class="controls">
                <p style="FONT-SIZE:14px; text-align:center"> {{teacher_name}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">开始时间 </label>
              <div class="controls">
                <p style="FONT-SIZE:14px; text-align:center"> {{start_time}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;">结束时间 </label>
              <div class="controls">
                <p style="FONT-SIZE:14px; text-align:center"> {{end_time}} </p>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" style="padding-left:100px;color:black;">仪器使用期间是否出现故障</label>
              <div class="controls" style="text-align:center">
                  {% if e_status == '正常' %}
                      <label><input type="radio" name="radios" value="good" checked="checked"/>否</label>
                      <label><input type="radio" name="radios" value="error"/>是</label>
                  {% else %}
                      <label><input type="radio" name="radios" value="good" />否</label>
                      <label><input type="radio" name="radios" value="error" checked="checked"/>是</label>
                  {% endif %}
              </div>
            </div>
<!--            <div class="control-group">-->
<!--              <label class="control-label" style="text-align:left;color:black;">仪器使用后状态</label>-->
<!--              <div class="controls" style="text-align:center">-->
<!--                  <label>-->
<!--                    <input type="radio" name="radios1" value="good"/>-->
<!--                    正常</label>-->
<!--                  <label>-->
<!--                    <input type="radio" name="radios1" value="error"/>-->
<!--                    故障</label>-->
<!--              </div>-->
<!--            </div>-->
            <div class="row-fluid" style="text-align:left;" >
                <div class="widget-title" style="color:black"> <span class="icon"> <i class="icon-envelope-alt"></i> </span>
                  <h5 style="color:black">实验报告及仪器状态描述</h5>
                </div>

                <div class="widget-content" style="text-align:left;">
                  <div class="control-group" style="text-align:left;">
                    <form method="post" action="#">
                      <div class="controls-row">
                        <textarea class="textarea_editor span12" name="details" rows="8" placeholder="Enter text ...">{{details}}</textarea>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

            <div class="form_actions" style="text-align:center;">
              <button type="submit" class="btn btn-success" style="margin:3px">保存</button>
              <button type="submit" class="btn btn-primary" style="margin:3px" onclick="tz()"> 返回</button>
              <button type="submit" value="Validate" class="btn btn-danger" style="margin:3px">提交</button>
            </div>

        </div>

          </form>
      </div>
    </div>
  </div>

</div></div>

<script src="{%static 'js/jquery.min.js'%}"></script>
<script src="{%static 'js/jquery.ui.custom.js'%}"></script>
<script src="{%static 'js/bootstrap.min.js'%}"></script>
<script src="{%static 'js/jquery.toggle.buttons.html'%}"></script>
<script src="{%static 'js/masked.js'%}"></script>
<script src="{%static 'js/jquery.uniform.js'%}"></script>
<script src="{%static 'js/select2.min.js'%}"></script>
<script src="{%static 'js/matrix.js'%}"></script>
<script src="{%static 'js/matrix.form_common.js'%}"></script>
<script src="{%static 'js/jquery.validate.js'%}"></script>
<script src="{%static 'js/wysihtml5-0.3.0.js'%}"></script>
<script src="{%static 'js/jquery.peity.min.js'%}"></script>
<script src="{%static 'js/bootstrap-wysihtml5.js'%}"></script>
<script>
    var options = {
        "html": false,
        "link": false,
        "image": false,
    };
	$('.textarea_editor').wysihtml5(options);
</script>
  <script>
    // 保存按钮
    $(".btn-success").click(function(){
      var name1 = $('input[name="radios"]:checked').val();
      console.log(name1);
      var text = $('textarea[name="details"]').val()
      $.ajax({
        type:"POST",
        url:"/save_log/",
        data:{
           csrfmiddlewaretoken: '{{ csrf_token }}',
           prev_equip_status: name1,
           details: text,
           log_id: {{log_id}}
         },
        success:function(result){
          console.log("success!")
          console.log(result)
          alert("保存成功！")
          setTimeout(function() {
            location.reload();
          }, 1 * 2000);
        },
        error:function(e){
          console.log(e.status);
          console.log(e.responseText);
        }
      })
    })

    // 提交按钮
    $(".btn-danger").click(function(){
          var name1 = $('input[name="radios"]:checked').val();
          var text = $('textarea[name="details"]').val()

          console.log(name1);
          console.log(text);
          if((name1 != 'good' && name1 != 'error') || text==''){
            //console.log('not right');
            window.alert(" 日志未填写完全 ! ");
          }
          else{
              if(name1 == 'error'){
                var statu = confirm("您是否确定仪器在使用期间出现异常？");
                if(statu){
                    $.ajax({
                        type:"POST",
                        //contentType:"application/json;charset=UTF-8",
                        url:"/submit_log/",
                        data:{
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            equip_status: name1,
                            details: text,
                            log_id: {{log_id}}
                        },
                        success:function(result){
                          console.log("success!")
                          console.log(result)
                          alert("提交成功！")
                          window.location.href="/logs/";
                          setTimeout(function() {
                            location.reload();
                          }, 1 * 2000);
                        },
                        error:function(e){
                          console.log(e.status);
                          console.log(e.responseText);
                        }
                  })
                }
              }
              else{
               $.ajax({
                        type:"POST",
                        //contentType:"application/json;charset=UTF-8",
                        url:"/submit_log/",
                        data:{
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            equip_status: name1,
                            details: text,
                            log_id: {{log_id}}
                        },
                        success:function(result){
                          console.log("success!")
                          console.log(result)
                          alert("提交成功！")
                          window.location.href="/logs/";
                          setTimeout(function() {
                            location.reload();
                          }, 1 * 2000);
                        },
                        error:function(e){
                          console.log(e.status);
                          console.log(e.responseText);
                        }
                  })
              }
          }

    })
  </script>
<script>
    // 返回按钮的跳转功能
    function tz(){
        window.location.href="/logs/";
    }
</script>
</body>
</html>
