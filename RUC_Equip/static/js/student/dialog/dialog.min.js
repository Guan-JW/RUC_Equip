/**
 * @author:   夏2同学
 * @time:     2020年8月16日13:07:43
 * @lastEdit: 2020年8月16日13:08:04
 * @content:  [原创插件] 自定义弹窗
 * @description : 
 * 	    - 本文件是压缩版本，
 *      - 同时将ES6语法转换成了es5语法，解决了一定的兼容性问题
 */

"use strict";
$.fn.dialog=function(options){
    var id=options.id,
    _options$title=options.title,
    title=_options$title===void 0?"我的标题":_options$title,
    _options$type=options.type,
    type=_options$type===void 0?0:_options$type,
    _options$easyClose=options.easyClose,
    easyClose=_options$easyClose===void 0?false:_options$easyClose,
    form=options.form,
    _options$submit=options.submit,
    submit=_options$submit===void 0?noSubmitFunc:_options$submit,
    _options$afterInit=options.afterInit,
    afterInit=_options$afterInit===void 0?noAfterInit:_options$afterInit;
    
    checkValue(id,form);
    init(id,title,type,form);
    afterInit();
    
    $(this).bind("click",{id:id},function(event){
        openDialog(event.data.id)
    });
    $("#"+id+" .btnCancel").bind("click",{id:id},function(event){
        closeDialog(event.data.id)
    });
    
    if(easyClose===true){
        $("."+"black_overlay").bind("click",{id:id},function(event){
            closeDialog(event.data.id)
        })
    }
    
    $("#"+id+" .btnConfirm").bind("click",{id:id},function(event){
        var data=serilizeToJSON($("#"+id+" form"));
        submit(data);
        closeDialog(event.data.id)
    })
};

function init(id,title,type,form){
    var before='\n\t\t<div id="'.concat(id,'1 " class="box white_content">\n\t\t\t<h4 class="font_title">').concat(title,'</h4>\n\t\t\t<form class="form_submit">\n\t');
    var core="";
    if(type===0){
        for(var i=0;i<form.length;i++){
            var temp="<div>\n\t\t\t\t<font>".concat(form[i].description,'\uFF1A</font>\n\t\t\t\t<span class="textInsert">\n\t\t\t\t\t<input type="').concat(form[i].type,'" name="').concat(form[i].name,'" value="').concat(form[i].value||"",'"/>\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t');
            core+=temp
        }
    }
    var after="";
    if(type===0){
        after='</form>\n\t\t\t\t<div class="bottom_btn">\n\t\t\t\t\t<button type="button" class="btnConfirm btn style="text-align:center;"">\u786E\u8BA4</button>\n\t\t\t\t\t<button type="button" class="btnCancel btn">\u53D6\u6D88</button>\n\t\t\t\t</div>\n\t\t\t\n\t\t\t</div>\n\t\t<div class="black_overlay fade"></div> '
    }
    else{
        var core = '<div id="stepBar1" class="ui-stepBar-wrap">\n\t\t\t<div class="ui-stepBar">\n\t\t\t\t<div class="ui-stepProcess"></div>\n\t\t\t</div>\n\t\t\t<div class="ui-stepInfo-wrap">\n\t\t\t\t<table class="ui-stepLayout" border="0" cellpadding="0" cellspacing="0">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class="ui-stepInfo" >\n\t\t\t\t\t\t\t<a class="ui-stepSequence">1</a>\n\t\t\t\t\t\t<p class="ui-stepName" style="text-align:left;">提交预约申请</p>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="ui-stepInfo">\n\t\t\t\t\t\t<a class="ui-stepSequence"  style="margin-left: 225px;">2</a>\n\t\t\t\t\t\t<p class="ui-stepName" style="margin-left: 180px;">教师审核通过</p>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class="ui-stepInfo">\n\t\t\t\t\t\t<a class="ui-stepSequence" style="margin-left: 450px;">3</a>\n\t\t\t\t\t\t<p class="ui-stepName" style="margin-left: 360px;text-align:right;"> 仪器管理员审核通过 </p>\n\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t\t</div>'
        after='\n\t\t\t</form>\n\t\t\t<div class="bottom_btn">\n\t\t\t\t<button type="button" class="btnCancel btn" style="margin-left: 50px;">\u5173\u95ED</button>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\t\t<div class="black_overlay fade"></div> '
        
    }
    var str=before+core+after;
    var element=document.createElement("div");
    element.innerHTML=str;
    $("body")[0].appendChild(element)
}

function openDialog(id){
    var element="#"+id;
    $(element)[0].style.display="block";
    $(element).next()[0].style.display="block"
}
function closeDialog(id){
    var element="#"+id;
    $(element)[0].style.display="none";
    $(element).next()[0].style.display="none"
}
function isEmpty(obj){
    if(typeof obj=="undefined"||obj==null||obj==""){
        return true
    }
    else{return false}
}
function serilizeToJSON(form){
    var result={};
    var arr=form.serializeArray();
    arr.forEach(function(item){
        result[item.name]=item.value
    });
    return result
}
function checkValue(id,form){
    if(isEmpty(id)){
        try{
            throw new Error("你必须初始化时设定id的值")
        }
        catch(e){
            console.error(e.name+": "+e.message)
        }
    }
    if(typeof id!=="string"){
        try{
            throw new Error("id的值的数据类型必须是字符串")
        }
        catch(e)
        {
            console.error(e.name+": "+e.message)
        }
    }

    if(isEmpty(form)){
        try{
            throw new Error("你必须初始化时设定form的值")
        }
        catch(e){
            console.error(e.name+": "+e.message)
        }
    }
}

function clearAllData(id){
    var obj=$("#"+id+" form input");
    for(var i=0;i<obj.length;i++){
        obj[i].value=""
    }
}

function moveBtn(id,height){
    var obj=$("#"+id+" .bottom_btn")[0];
    obj.style.top=""+height+"px"
}

function noSubmitFunc(){
    console.log("您初始化时没有设置submit参数!!!")
}

function noAfterInit(){};